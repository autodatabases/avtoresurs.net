{% extends 'base.html' %}

{% block title %}{{ object.title }}{% endblock title %}

{% block content %}

    <!-- BREADCRUMBS -->
    <ol class="breadcrumb">
        <li><a href="index.html">Главная</a></li>
        <li><a href="/catalog">Интернет-магазин</a></li>
        <li class="active">{{ object.title }}</li>
    </ol>

    <!-- MAIN CONTENT -->
    <div class="row">
        <p class="lead" id="jquery-message">

        </p>

        <div class="col-xs-12 col-sm-4">
            {% if object.productimage_set.count > 0 %}
                {% for img in object.productimage_set.all %}
                    <img src="{{ img.image.url }}" alt="" class="img-thumbnail">
                {% endfor %}
            {% else %}
                <img src="http://placehold.it/300x200" alt="" class="img-thumbnail">
            {% endif %}
        </div>
        <div class="col-xs-12 col-sm-8">

            <h4 class="avtoresurs-detail">{{ object.title }}</h4>
            <hr>

            <div class="id avtoresurs-id"><h4>ID: #</h4></div>
            <div class="avtoresurs-detail-disc">
                <h4>Производитель: <span class="avtoresurs-item-detail">{{ object.manufacturer }}</span></h4>
                <h4>Код детали: <span class="avtoresurs-item-detail">{{ object.sku }}</span></h4>
                <h4>Количество на складе: <span class="avtoresurs-item-detail">{{ object.quantity }}</span></h4>
                <h4>Цена: <span class="avtoresurs-item-detail"><b>{{ object.get_price }}</b></span></h4>
            </div>
            <div class="prdt-cost">
                <ul>
                    <li>
                        <form method="GET" action="{% url 'cart' %}" id="add-form" class="form-inline">
                            <input type="hidden" name="item" value="{{ object.id }}">
                            <div class="row item-detail-qty">
                                <div class="col-xs-4">
                                    <input type="number" class="form-control" name="qty" value="1">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    <input type="submit" class="btn btn-default" value="В корзину" id="submit-btn">
                                </div>
                            </div>
                        </form>
                    </li>
                </ul>


            </div>

            {#                <p>{{ object.get_absolute_url }}</p>#}
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-4">
            <p>Аналоги:</p>
        </div>
    </div>
    <div class="row">
        {% for analog in analogs %}
            <p>{{ analog }} - {{ analog.price }} ({{ analog.qty }})</p>
        {% endfor %}
    </div>

{% endblock %}


{% block jquery %}
    <script>
        $('#submit-btn').click(function (event) {
            event.preventDefault();
            var formData = $('#add-form').serialize();
            console.log(formData);
            $.ajax({
                type: "GET",
                url: "{% url 'cart' %}",
                data: formData,
                success: function (data) {
                    {#                    console.log(data)#}
                    {#                    $('#jquery-message').text("Added " + data.item_added + " Deleted " + data.deleted);#}
                    showFlashMessage(data.flash_message);
                    updateCartItemCount();
                },
                error: function (response, error) {
                    {#                    console.log(response);#}
                    {#                    console.log(error);#}
                    $('#add-form').submit();
                }
            })
            {#            $('#add-form').submit;#}
        });
    </script>
{% endblock %}
